<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Summary Daily Delivery Order</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome untuk icon -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Chart.js untuk visualisasi data -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- SheetJS untuk membaca file Excel -->
    <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f8f9fa;
            color: #333;
        }
        .header {
            background-color: #2c3e50;
            color: white;
            padding: 15px 0;
            margin-bottom: 20px;
        }
        .filter-section {
            background-color: #ecf0f1;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
        }
        .kpi-card {
            background-color: white;
            border-radius: 5px;
            padding: 15px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            margin-bottom: 15px;
            text-align: center;
        }
        .kpi-value {
            font-size: 24px;
            font-weight: bold;
            color: #2c3e50;
        }
        .kpi-label {
            font-size: 14px;
            color: #7f8c8d;
        }
        .chart-container {
            background-color: white;
            border-radius: 5px;
            padding: 15px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        .chart-title {
            font-size: 16px;
            font-weight: bold;
            margin-bottom: 15px;
            color: #2c3e50;
        }
        .nav-tabs .nav-link {
            color: #2c3e50;
            font-weight: 500;
        }
        .nav-tabs .nav-link.active {
            color: #e74c3c;
            font-weight: 600;
        }
        .footer {
            background-color: #2c3e50;
            color: white;
            padding: 10px 0;
            text-align: center;
            margin-top: 30px;
        }
        .upload-area {
            border: 2px dashed #3498db;
            padding: 20px;
            text-align: center;
            border-radius: 5px;
            margin-bottom: 20px;
            background-color: #eaf2f8;
        }
        .filter-toggle {
            cursor: pointer;
            color: #3498db;
            margin-bottom: 10px;
            display: inline-block;
        }
        .icon-box {
            display: inline-block;
            width: 30px;
            height: 30px;
            background-color: #3498db;
            color: white;
            border-radius: 50%;
            text-align: center;
            line-height: 30px;
            margin-right: 10px;
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="container">
            <h1 class="text-center">Summary Daily Delivery Order</h1>
            <p class="text-center" id="last-update">Last Update: -</p>
        </div>
    </div>

    <div class="container">
        <!-- Upload Section -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="upload-area">
                    <h4>Upload File Excel</h4>
                    <p>File harus berformat Excel (.xlsx) dengan ukuran 2MB - 30MB</p>
                    <input type="file" id="file-upload" class="form-control" accept=".xlsx, .xls">
                    <div class="mt-2">
                        <small class="form-text text-muted">
                            Pastikan file Excel memiliki kolom: Area, DP Date, DP No, Plant Name, QTY, Truck No, Sales Man, Distance, End Customer Name
                        </small>
                    </div>
                </div>
            </div>
        </div>

        <!-- Filter Section -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="filter-section">
                    <h5 class="filter-toggle" data-bs-toggle="collapse" href="#filterCollapse">
                        <i class="fas fa-filter"></i> Filter Data <i class="fas fa-chevron-down"></i>
                    </h5>
                    <div class="collapse show" id="filterCollapse">
                        <div class="row">
                            <div class="col-md-4 mb-2">
                                <label for="area-filter" class="form-label">Area</label>
                                <select class="form-select" id="area-filter" multiple>
                                    <!-- Options akan diisi oleh JavaScript -->
                                </select>
                            </div>
                            <div class="col-md-4 mb-2">
                                <label for="start-date" class="form-label">Start Date</label>
                                <input type="date" class="form-control" id="start-date">
                            </div>
                            <div class="col-md-4 mb-2">
                                <label for="end-date" class="form-label">End Date</label>
                                <input type="date" class="form-control" id="end-date">
                            </div>
                            <div class="col-md-4 mb-2">
                                <label for="plant-filter" class="form-label">Plant Name</label>
                                <select class="form-select" id="plant-filter" multiple>
                                    <!-- Options akan diisi oleh JavaScript -->
                                </select>
                            </div>
                            <div class="col-md-4 mb-2">
                                <label for="salesman-filter" class="form-label">Sales Man</label>
                                <select class="form-select" id="salesman-filter" multiple>
                                    <!-- Options akan diisi oleh JavaScript -->
                                </select>
                            </div>
                            <div class="col-md-4 mb-2">
                                <label for="customer-filter" class="form-label">End Customer Name</label>
                                <select class="form-select" id="customer-filter" multiple>
                                    <!-- Options akan diisi oleh JavaScript -->
                                </select>
                            </div>
                            <div class="col-12 mt-2">
                                <button class="btn btn-primary" id="apply-filters">Terapkan Filter</button>
                                <button class="btn btn-secondary" id="reset-filters">Reset Filter</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- KPI Section -->
        <div class="row mb-4">
            <div class="col-md-2 col-sm-6">
                <div class="kpi-card">
                    <div class="kpi-value" id="total-area">0</div>
                    <div class="kpi-label">Total Area</div>
                </div>
            </div>
            <div class="col-md-2 col-sm-6">
                <div class="kpi-card">
                    <div class="kpi-value" id="total-plant">0</div>
                    <div class="kpi-label">Total Plant</div>
                </div>
            </div>
            <div class="col-md-2 col-sm-6">
                <div class="kpi-card">
                    <div class="kpi-value" id="total-volume">0</div>
                    <div class="kpi-label">Total Volume</div>
                </div>
            </div>
            <div class="col-md-2 col-sm-6">
                <div class="kpi-card">
                    <div class="kpi-value" id="avg-volume">0</div>
                    <div class="kpi-label">Avg Volume</div>
                </div>
            </div>
            <div class="col-md-2 col-sm-6">
                <div class="kpi-card">
                    <div class="kpi-value" id="total-tm">0</div>
                    <div class="kpi-label">Total TM</div>
                </div>
            </div>
            <div class="col-md-2 col-sm-6">
                <div class="kpi-card">
                    <div class="kpi-value" id="avg-load-trip">0</div>
                    <div class="kpi-label">Avg Load/Trip</div>
                </div>
            </div>
        </div>

        <!-- Tab Navigation -->
        <ul class="nav nav-tabs mb-4" id="dashboardTabs" role="tablist">
            <li class="nav-item" role="presentation">
                <button class="nav-link active" id="logistic-tab" data-bs-toggle="tab" data-bs-target="#logistic" type="button" role="tab" aria-controls="logistic" aria-selected="true">
                    <i class="fas fa-truck"></i> Logistic
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="sales-tab" data-bs-toggle="tab" data-bs-target="#sales" type="button" role="tab" aria-controls="sales" aria-selected="false">
                    <i class="fas fa-chart-line"></i> Sales And End Customer Performance
                </button>
            </li>
        </ul>

        <!-- Tab Content -->
        <div class="tab-content" id="dashboardTabContent">
            <!-- Logistic Tab -->
            <div class="tab-pane fade show active" id="logistic" role="tabpanel" aria-labelledby="logistic-tab">
                <div class="row mb-4">
                    <div class="col-12">
                        <h4><span class="icon-box"><i class="fas fa-chart-bar"></i></span> Delivery Performance</h4>
                    </div>
                </div>
                
                <div class="row">
                    <div class="col-md-6">
                        <div class="chart-container">
                            <div class="chart-title">Total Volume Delivery Per Area</div>
                            <canvas id="volume-per-area-chart"></canvas>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="chart-container">
                            <div class="chart-title">Total Volume Delivery Per Plant Name</div>
                            <canvas id="volume-per-plant-chart"></canvas>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="chart-container">
                            <div class="chart-title">Avg Volume Delivery Per Area</div>
                            <canvas id="avg-volume-area-chart"></canvas>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="chart-container">
                            <div class="chart-title">Avg Volume Delivery Per Plant Name</div>
                            <canvas id="avg-volume-plant-chart"></canvas>
                        </div>
                    </div>
                </div>
                
                <div class="row mb-4 mt-4">
                    <div class="col-12">
                        <h4><span class="icon-box"><i class="fas fa-truck-loading"></i></span> Truck Utilization</h4>
                    </div>
                </div>
                
                <div class="row">
                    <div class="col-md-6">
                        <div class="chart-container">
                            <div class="chart-title">Total Volume Delivery Per Truck No</div>
                            <canvas id="volume-per-truck-chart"></canvas>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="chart-container">
                            <div class="chart-title">Total Trip per Truck No</div>
                            <canvas id="trip-per-truck-chart"></canvas>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="chart-container">
                            <div class="chart-title">Avg Load per Trip per Truck No</div>
                            <canvas id="avg-load-truck-chart"></canvas>
                        </div>
                    </div>
                </div>
                
                <div class="row mb-4 mt-4">
                    <div class="col-12">
                        <h4><span class="icon-box"><i class="fas fa-route"></i></span> Distance</h4>
                    </div>
                </div>
                
                <div class="row">
                    <div class="col-md-6">
                        <div class="chart-container">
                            <div class="chart-title">Avg Distance Per Area</div>
                            <canvas id="avg-distance-area-chart"></canvas>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="chart-container">
                            <div class="chart-title">Avg Distance Per Plant Name</div>
                            <canvas id="avg-distance-plant-chart"></canvas>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Sales Tab -->
            <div class="tab-pane fade" id="sales" role="tabpanel" aria-labelledby="sales-tab">
                <div class="row">
                    <div class="col-md-6">
                        <div class="chart-container">
                            <div class="chart-title">Total Volume Per Sales Man</div>
                            <canvas id="volume-salesman-chart"></canvas>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="chart-container">
                            <div class="chart-title">Total Volume Per End Customer Name</div>
                            <canvas id="volume-customer-chart"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="footer">
        <div class="container">
            <p>Summary Daily Delivery Order by L=23-51Xe</p>
        </div>
    </div>

    <!-- Bootstrap & jQuery JS -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <script>
        // Data global untuk menyimpan data Excel
        let rawData = [];
        let filteredData = [];
        
        // Chart objects
        let charts = {};
        
        // Update last update time
        function updateLastUpdateTime() {
            const now = new Date();
            const formattedDate = now.toLocaleString('id-ID', {
                day: '2-digit',
                month: '2-digit',
                year: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            });
            document.getElementById('last-update').textContent = `Last Update: ${formattedDate}`;
        }
        
        // Inisialisasi
        document.addEventListener('DOMContentLoaded', function() {
            updateLastUpdateTime();
            
            // Event listener untuk upload file
            document.getElementById('file-upload').addEventListener('change', handleFileUpload);
            
            // Event listener untuk filter
            document.getElementById('apply-filters').addEventListener('click', applyFilters);
            document.getElementById('reset-filters').addEventListener('click', resetFilters);
            
            // Event listener untuk area filter change (untuk update plant filter)
            document.getElementById('area-filter').addEventListener('change', updatePlantFilterOptions);
        });
        
        // Handle file upload
        function handleFileUpload(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            // Validasi ukuran file
            const fileSizeMB = file.size / (1024 * 1024);
            if (fileSizeMB < 2 || fileSizeMB > 30) {
                alert('Ukuran file harus antara 2MB dan 30MB');
                return;
            }
            
            const reader = new FileReader();
            reader.onload = function(e) {
                const data = new Uint8Array(e.target.result);
                const workbook = XLSX.read(data, { type: 'array' });
                
                // Ambil data dari sheet pertama
                const worksheet = workbook.Sheets[workbook.SheetNames[0]];
                const jsonData = XLSX.utils.sheet_to_json(worksheet);
                
                // Simpan data mentah
                rawData = jsonData;
                filteredData = [...rawData];
                
                // Update filter options
                updateFilterOptions();
                
                // Proses data dan update dashboard
                processData();
            };
            reader.readAsArrayBuffer(file);
        }
        
        // Update opsi filter
        function updateFilterOptions() {
            // Area filter
            const areas = [...new Set(rawData.map(item => item.Area))].filter(Boolean);
            const areaFilter = document.getElementById('area-filter');
            areaFilter.innerHTML = '';
            areas.forEach(area => {
                const option = document.createElement('option');
                option.value = area;
                option.textContent = area;
                areaFilter.appendChild(option);
            });
            
            // Plant filter
            updatePlantFilterOptions();
            
            // Salesman filter
            const salesmen = [...new Set(rawData.map(item => item['Sales Man']))].filter(Boolean);
            const salesmanFilter = document.getElementById('salesman-filter');
            salesmanFilter.innerHTML = '';
            salesmen.forEach(salesman => {
                const option = document.createElement('option');
                option.value = salesman;
                option.textContent = salesman;
                salesmanFilter.appendChild(option);
            });
            
            // Customer filter
            const customers = [...new Set(rawData.map(item => item['End Customer Name']))].filter(Boolean);
            const customerFilter = document.getElementById('customer-filter');
            customerFilter.innerHTML = '';
            customers.forEach(customer => {
                const option = document.createElement('option');
                option.value = customer;
                option.textContent = customer;
                customerFilter.appendChild(option);
            });
            
            // Set date range
            const dates = rawData.map(item => new Date(item['DP Date'])).filter(d => !isNaN(d));
            const minDate = new Date(Math.min.apply(null, dates));
            const maxDate = new Date(Math.max.apply(null, dates));
            
            document.getElementById('start-date').valueAsDate = minDate;
            document.getElementById('end-date').valueAsDate = maxDate;
        }
        
        // Update plant filter berdasarkan area yang dipilih
        function updatePlantFilterOptions() {
            const selectedAreas = Array.from(document.getElementById('area-filter').selectedOptions)
                .map(option => option.value);
            
            let plants;
            if (selectedAreas.length > 0) {
                plants = [...new Set(rawData
                    .filter(item => selectedAreas.includes(item.Area))
                    .map(item => item['Plant Name'])
                )].filter(Boolean);
            } else {
                plants = [...new Set(rawData.map(item => item['Plant Name']))].filter(Boolean);
            }
            
            const plantFilter = document.getElementById('plant-filter');
            plantFilter.innerHTML = '';
            plants.forEach(plant => {
                const option = document.createElement('option');
                option.value = plant;
                option.textContent = plant;
                plantFilter.appendChild(option);
            });
        }
        
        // Terapkan filter
        function applyFilters() {
            const selectedAreas = Array.from(document.getElementById('area-filter').selectedOptions)
                .map(option => option.value);
            const selectedPlants = Array.from(document.getElementById('plant-filter').selectedOptions)
                .map(option => option.value);
            const selectedSalesmen = Array.from(document.getElementById('salesman-filter').selectedOptions)
                .map(option => option.value);
            const selectedCustomers = Array.from(document.getElementById('customer-filter').selectedOptions)
                .map(option => option.value);
            
            const startDate = new Date(document.getElementById('start-date').value);
            const endDate = new Date(document.getElementById('end-date').value);
            endDate.setHours(23, 59, 59, 999); // Sampai akhir hari
            
            filteredData = rawData.filter(item => {
                // Filter area
                if (selectedAreas.length > 0 && !selectedAreas.includes(item.Area)) {
                    return false;
                }
                
                // Filter plant
                if (selectedPlants.length > 0 && !selectedPlants.includes(item['Plant Name'])) {
                    return false;
                }
                
                // Filter salesman
                if (selectedSalesmen.length > 0 && !selectedSalesmen.includes(item['Sales Man'])) {
                    return false;
                }
                
                // Filter customer
                if (selectedCustomers.length > 0 && !selectedCustomers.includes(item['End Customer Name'])) {
                    return false;
                }
                
                // Filter tanggal
                const itemDate = new Date(item['DP Date']);
                if (itemDate < startDate || itemDate > endDate) {
                    return false;
                }
                
                return true;
            });
            
            // Update dashboard dengan data yang sudah difilter
            processData();
        }
        
        // Reset filter
        function resetFilters() {
            document.getElementById('area-filter').selectedIndex = -1;
            document.getElementById('plant-filter').selectedIndex = -1;
            document.getElementById('salesman-filter').selectedIndex = -1;
            document.getElementById('customer-filter').selectedIndex = -1;
            
            const dates = rawData.map(item => new Date(item['DP Date'])).filter(d => !isNaN(d));
            const minDate = new Date(Math.min.apply(null, dates));
            const maxDate = new Date(Math.max.apply(null, dates));
            
            document.getElementById('start-date').valueAsDate = minDate;
            document.getElementById('end-date').valueAsDate = maxDate;
            
            filteredData = [...rawData];
            processData();
        }
        
        // Proses data dan update dashboard
        function processData() {
            updateLastUpdateTime();
            updateKPIs();
            updateCharts();
        }
        
        // Update KPI cards
        function updateKPIs() {
            // Total Area
            const totalArea = new Set(filteredData.map(item => item.Area)).size;
            document.getElementById('total-area').textContent = totalArea;
            
            // Total Plant
            const totalPlant = new Set(filteredData.map(item => item['Plant Name'])).size;
            document.getElementById('total-plant').textContent = totalPlant;
            
            // Total Volume
            const totalVolume = filteredData.reduce((sum, item) => sum + (Number(item.QTY) || 0), 0);
            document.getElementById('total-volume').textContent = totalVolume.toLocaleString();
            
            // Avg Volume
            const avgVolume = filteredData.length > 0 ? totalVolume / filteredData.length : 0;
            document.getElementById('avg-volume').textContent = avgVolume.toFixed(2);
            
            // Total TM (Truck No)
            const totalTM = new Set(filteredData.map(item => item['Truck No'])).size;
            document.getElementById('total-tm').textContent = totalTM;
            
            // Total Trip (DP No)
            const totalTrip = new Set(filteredData.map(item => item['DP No'])).size;
            
            // Avg Load/Trip
            const avgLoadTrip = totalTrip > 0 ? totalVolume / totalTrip : 0;
            document.getElementById('avg-load-trip').textContent = avgLoadTrip.toFixed(2);
        }
        
        // Update semua charts
        function updateCharts() {
            updateVolumePerAreaChart();
            updateVolumePerPlantChart();
            updateAvgVolumeAreaChart();
            updateAvgVolumePlantChart();
            updateVolumePerTruckChart();
            updateTripPerTruckChart();
            updateAvgLoadTruckChart();
            updateAvgDistanceAreaChart();
            updateAvgDistancePlantChart();
            updateVolumeSalesmanChart();
            updateVolumeCustomerChart();
        }
        
        // Chart: Total Volume Delivery Per Area
        function updateVolumePerAreaChart() {
            const areaVolume = {};
            filteredData.forEach(item => {
                const area = item.Area || 'Unknown';
                const volume = Number(item.QTY) || 0;
                areaVolume[area] = (areaVolume[area] || 0) + volume;
            });
            
            const ctx = document.getElementById('volume-per-area-chart').getContext('2d');
            if (charts['volumePerArea']) {
                charts['volumePerArea'].destroy();
            }
            
            charts['volumePerArea'] = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: Object.keys(areaVolume),
                    datasets: [{
                        label: 'Total Volume',
                        data: Object.values(areaVolume),
                        backgroundColor: 'rgba(54, 162, 235, 0.7)',
                        borderColor: 'rgba(54, 162, 235, 1)',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
        }
        
        // Chart: Total Volume Delivery Per Plant Name
        function updateVolumePerPlantChart() {
            const plantVolume = {};
            filteredData.forEach(item => {
                const plant = item['Plant Name'] || 'Unknown';
                const volume = Number(item.QTY) || 0;
                plantVolume[plant] = (plantVolume[plant] || 0) + volume;
            });
            
            // Ambil hanya 10 plant dengan volume tertinggi untuk kejelasan visual
            const sortedPlants = Object.entries(plantVolume)
                .sort((a, b) => b[1] - a[1])
                .slice(0, 10);
            
            const ctx = document.getElementById('volume-per-plant-chart').getContext('2d');
            if (charts['volumePerPlant']) {
                charts['volumePerPlant'].destroy();
            }
            
            charts['volumePerPlant'] = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: sortedPlants.map(item => item[0]),
                    datasets: [{
                        label: 'Total Volume',
                        data: sortedPlants.map(item => item[1]),
                        backgroundColor: 'rgba(75, 192, 192, 0.7)',
                        borderColor: 'rgba(75, 192, 192, 1)',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
        }
        
        // Chart: Avg Volume Delivery Per Area
        function updateAvgVolumeAreaChart() {
            const areaData = {};
            filteredData.forEach(item => {
                const area = item.Area || 'Unknown';
                const volume = Number(item.QTY) || 0;
                if (!areaData[area]) {
                    areaData[area] = { total: 0, count: 0 };
                }
                areaData[area].total += volume;
                areaData[area].count += 1;
            });
            
            const areaAvg = {};
            Object.keys(areaData).forEach(area => {
                areaAvg[area] = areaData[area].total / areaData[area].count;
            });
            
            const ctx = document.getElementById('avg-volume-area-chart').getContext('2d');
            if (charts['avgVolumeArea']) {
                charts['avgVolumeArea'].destroy();
            }
            
            charts['avgVolumeArea'] = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: Object.keys(areaAvg),
                    datasets: [{
                        label: 'Average Volume',
                        data: Object.values(areaAvg),
                        backgroundColor: 'rgba(255, 159, 64, 0.7)',
                        borderColor: 'rgba(255, 159, 64, 1)',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
        }
        
        // Chart: Avg Volume Delivery Per Plant Name
        function updateAvgVolumePlantChart() {
            const plantData = {};
            filteredData.forEach(item => {
                const plant = item['Plant Name'] || 'Unknown';
                const volume = Number(item.QTY) || 0;
                if (!plantData[plant]) {
                    plantData[plant] = { total: 0, count: 0 };
                }
                plantData[plant].total += volume;
                plantData[plant].count += 1;
            });
            
            const plantAvg = {};
            Object.keys(plantData).forEach(plant => {
                plantAvg[plant] = plantData[plant].total / plantData[plant].count;
            });
            
            // Ambil hanya 10 plant dengan volume tertinggi untuk kejelasan visual
            const sortedPlants = Object.entries(plantAvg)
                .sort((a, b) => b[1] - a[1])
                .slice(0, 10);
            
            const ctx = document.getElementById('avg-volume-plant-chart').getContext('2d');
            if (charts['avgVolumePlant']) {
                charts['avgVolumePlant'].destroy();
            }
            
            charts['avgVolumePlant'] = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: sortedPlants.map(item => item[0]),
                    datasets: [{
                        label: 'Average Volume',
                        data: sortedPlants.map(item => item[1]),
                        backgroundColor: 'rgba(153, 102, 255, 0.7)',
                        borderColor: 'rgba(153, 102, 255, 1)',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
        }
        
        // Chart: Total Volume Delivery Per Truck No
        function updateVolumePerTruckChart() {
            const truckVolume = {};
            filteredData.forEach(item => {
                const truck = item['Truck No'] || 'Unknown';
                const volume = Number(item.QTY) || 0;
                truckVolume[truck] = (truckVolume[truck] || 0) + volume;
            });
            
            // Ambil hanya 10 truck dengan volume tertinggi untuk kejelasan visual
            const sortedTrucks = Object.entries(truckVolume)
                .sort((a, b) => b[1] - a[1])
                .slice(0, 10);
            
            const ctx = document.getElementById('volume-per-truck-chart').getContext('2d');
            if (charts['volumePerTruck']) {
                charts['volumePerTruck'].destroy();
            }
            
            charts['volumePerTruck'] = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: sortedTrucks.map(item => item[0]),
                    datasets: [{
                        label: 'Total Volume',
                        data: sortedTrucks.map(item => item[1]),
                        backgroundColor: 'rgba(255, 99, 132, 0.7)',
                        borderColor: 'rgba(255, 99, 132, 1)',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
        }
        
        // Chart: Total Trip per Truck No
        function updateTripPerTruckChart() {
            const truckTrips = {};
            filteredData.forEach(item => {
                const truck = item['Truck No'] || 'Unknown';
                const dpNo = item['DP No'];
                if (dpNo) {
                    if (!truckTrips[truck]) {
                        truckTrips[truck] = new Set();
                    }
                    truckTrips[truck].add(dpNo);
                }
            });
            
            const truckTripCounts = {};
            Object.keys(truckTrips).forEach(truck => {
                truckTripCounts[truck] = truckTrips[truck].size;
            });
            
            // Ambil hanya 10 truck dengan trip tertinggi untuk kejelasan visual
            const sortedTrucks = Object.entries(truckTripCounts)
                .sort((a, b) => b[1] - a[1])
                .slice(0, 10);
            
            const ctx = document.getElementById('trip-per-truck-chart').getContext('2d');
            if (charts['tripPerTruck']) {
                charts['tripPerTruck'].destroy();
            }
            
            charts['tripPerTruck'] = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: sortedTrucks.map(item => item[0]),
                    datasets: [{
                        label: 'Total Trip',
                        data: sortedTrucks.map(item => item[1]),
                        backgroundColor: 'rgba(255, 205, 86, 0.7)',
                        borderColor: 'rgba(255, 205, 86, 1)',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
        }
        
        // Chart: Avg Load per Trip per Truck No
        function updateAvgLoadTruckChart() {
            const truckData = {};
            filteredData.forEach(item => {
                const truck = item['Truck No'] || 'Unknown';
                const volume = Number(item.QTY) || 0;
                const dpNo = item['DP No'];
                
                if (!truckData[truck]) {
                    truckData[truck] = { totalVolume: 0, trips: new Set() };
                }
                
                truckData[truck].totalVolume += volume;
                if (dpNo) {
                    truckData[truck].trips.add(dpNo);
                }
            });
            
            const truckAvgLoad = {};
            Object.keys(truckData).forEach(truck => {
                const tripCount = truckData[truck].trips.size;
                truckAvgLoad[truck] = tripCount > 0 ? truckData[truck].totalVolume / tripCount : 0;
            });
            
            // Ambil hanya 10 truck dengan avg load tertinggi untuk kejelasan visual
            const sortedTrucks = Object.entries(truckAvgLoad)
                .sort((a, b) => b[1] - a[1])
                .slice(0, 10);
            
            const ctx = document.getElementById('avg-load-truck-chart').getContext('2d');
            if (charts['avgLoadTruck']) {
                charts['avgLoadTruck'].destroy();
            }
            
            charts['avgLoadTruck'] = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: sortedTrucks.map(item => item[0]),
                    datasets: [{
                        label: 'Avg Load per Trip',
                        data: sortedTrucks.map(item => item[1]),
                        backgroundColor: 'rgba(201, 203, 207, 0.7)',
                        borderColor: 'rgba(201, 203, 207, 1)',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
        }
        
        // Chart: Avg Distance Per Area
        function updateAvgDistanceAreaChart() {
            const areaData = {};
            filteredData.forEach(item => {
                const area = item.Area || 'Unknown';
                const distance = Number(item.Distance) || 0;
                if (!areaData[area]) {
                    areaData[area] = { total: 0, count: 0 };
                }
                areaData[area].total += distance;
                areaData[area].count += 1;
            });
            
            const areaAvgDistance = {};
            Object.keys(areaData).forEach(area => {
                areaAvgDistance[area] = areaData[area].total / areaData[area].count;
            });
            
            const ctx = document.getElementById('avg-distance-area-chart').getContext('2d');
            if (charts['avgDistanceArea']) {
                charts['avgDistanceArea'].destroy();
            }
            
            charts['avgDistanceArea'] = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: Object.keys(areaAvgDistance),
                    datasets: [{
                        label: 'Average Distance',
                        data: Object.values(areaAvgDistance),
                        backgroundColor: 'rgba(54, 162, 235, 0.7)',
                        borderColor: 'rgba(54, 162, 235, 1)',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
        }
        
        // Chart: Avg Distance Per Plant Name
        function updateAvgDistancePlantChart() {
            const plantData = {};
            filteredData.forEach(item => {
                const plant = item['Plant Name'] || 'Unknown';
                const distance = Number(item.Distance) || 0;
                if (!plantData[plant]) {
                    plantData[plant] = { total: 0, count: 0 };
                }
                plantData[plant].total += distance;
                plantData[plant].count += 1;
            });
            
            const plantAvgDistance = {};
            Object.keys(plantData).forEach(plant => {
                plantAvgDistance[plant] = plantData[plant].total / plantData[plant].count;
            });
            
            // Ambil hanya 10 plant dengan distance tertinggi untuk kejelasan visual
            const sortedPlants = Object.entries(plantAvgDistance)
                .sort((a, b) => b[1] - a[1])
                .slice(0, 10);
            
            const ctx = document.getElementById('avg-distance-plant-chart').getContext('2d');
            if (charts['avgDistancePlant']) {
                charts['avgDistancePlant'].destroy();
            }
            
            charts['avgDistancePlant'] = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: sortedPlants.map(item => item[0]),
                    datasets: [{
                        label: 'Average Distance',
                        data: sortedPlants.map(item => item[1]),
                        backgroundColor: 'rgba(75, 192, 192, 0.7)',
                        borderColor: 'rgba(75, 192, 192, 1)',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
        }
        
        // Chart: Total Volume Per Sales Man
        function updateVolumeSalesmanChart() {
            const salesmanVolume = {};
            filteredData.forEach(item => {
                const salesman = item['Sales Man'] || 'Unknown';
                const volume = Number(item.QTY) || 0;
                salesmanVolume[salesman] = (salesmanVolume[salesman] || 0) + volume;
            });
            
            // Ambil hanya 10 salesman dengan volume tertinggi untuk kejelasan visual
            const sortedSalesmen = Object.entries(salesmanVolume)
                .sort((a, b) => b[1] - a[1])
                .slice(0, 10);
            
            const ctx = document.getElementById('volume-salesman-chart').getContext('2d');
            if (charts['volumeSalesman']) {
                charts['volumeSalesman'].destroy();
            }
            
            charts['volumeSalesman'] = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: sortedSalesmen.map(item => item[0]),
                    datasets: [{
                        label: 'Total Volume',
                        data: sortedSalesmen.map(item => item[1]),
                        backgroundColor: 'rgba(255, 99, 132, 0.7)',
                        borderColor: 'rgba(255, 99, 132, 1)',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
        }
        
        // Chart: Total Volume Per End Customer Name
        function updateVolumeCustomerChart() {
            const customerVolume = {};
            filteredData.forEach(item => {
                const customer = item['End Customer Name'] || 'Unknown';
                const volume = Number(item.QTY) || 0;
                customerVolume[customer] = (customerVolume[customer] || 0) + volume;
            });
            
            // Ambil hanya 10 customer dengan volume tertinggi untuk kejelasan visual
            const sortedCustomers = Object.entries(customerVolume)
                .sort((a, b) => b[1] - a[1])
                .slice(0, 10);
            
            const ctx = document.getElementById('volume-customer-chart').getContext('2d');
            if (charts['volumeCustomer']) {
                charts['volumeCustomer'].destroy();
            }
            
            charts['volumeCustomer'] = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: sortedCustomers.map(item => item[0]),
                    datasets: [{
                        label: 'Total Volume',
                        data: sortedCustomers.map(item => item[1]),
                        backgroundColor: 'rgba(153, 102, 255, 0.7)',
                        borderColor: 'rgba(153, 102, 255, 1)',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
        }
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="scripts/main.js"></script>
    <script src="scripts/data-processor.js"></script>
    <script src="scripts/chart-renderer.js"></script>
    <script src="scripts/data-generator.js"></script>
</body>
</html>
